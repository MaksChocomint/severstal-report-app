generator client {
  provider = "prisma-client-js"
  output   = "../app/generated/prisma" // Убедитесь, что путь корректен
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Report {
  id                  Int    @id @default(autoincrement())
  ladlePassportNumber String

  // Связь с создателем отчета
  authorId Int // Внешний ключ для User
  author   User @relation(fields: [authorId], references: [id])

  // Раздел плавки 
  meltNumber         Int
  meltUnrs           Int
  meltStartDateTime  DateTime
  meltEndDateTime    DateTime
  meltLadleStability Int

  // Раздел торкретирования
  arrivalDate          DateTime
  torcretingDate       DateTime
  mixtures             String
  assemblyHandoverDate DateTime

  // Раздел расположения термоблоков
  thermalBlockDistance   Int
  thermalBlockProtrusion Int
  thermalBlockCondition  String?

  // Раздел сборки
  doserCupType              String
  doserCupInstaller         String
  stopperMonoblockType      String
  stopperMonoblockInstaller String
  valve1                    String
  valve2                    String
  turbostop                 String?

  // Раздел подготовки к разливке (единичный объект)
  pouringHandoverDateTime DateTime
  heatingStartDateTime    DateTime
  heatingDuration         String
  operatorName            String

  // Детали первой плавки при разливке
  pour1MeltNumber     Int
  pour1Unrs           Int // Добавил pour1Unrs для консистентности, если нужно
  pour1StartDateTime  DateTime
  pour1EndDateTime    DateTime
  pour1SeriesPosition String
  pour1LadleStability Int

  // Детали второй плавки при разливке
  pour2MeltNumber     Int
  pour2StartDateTime  DateTime
  pour2EndDateTime    DateTime
  pour2LadleStability Int

  // Замечания
  torcretingRemarks String?
  assemblyRemarks   String?
  heatingRemarks    String?
  pouringRemarks    String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum Role {
  USER
  REPORTER
}

model User {
  id       Int    @id @default(autoincrement())
  name     String @unique
  email    String @unique
  password String
  role     Role   @default(USER)

  // Связь с отчетами (один пользователь может создать много отчетов)
  reports Report[]
}

model OptionItem {
  id     Int    @id @default(autoincrement()) @map("PK_NSI_BUILD_ID") // Или просто @id @default(autoincrement()) если не нужно маппить на старый ID
  name   String @map("PK_NSI_BUILD_NAME")
  typeId Int    @map("PK_NSI_BUILD_PRZ") // 1: стакан дозатор, 2: стопор-моноблок, 3: смеси
}

model LadlePassportNumber {
  id     Int    @id @default(autoincrement())
  number String @unique
}
